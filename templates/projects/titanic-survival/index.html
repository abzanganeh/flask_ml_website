{% extends "base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/projects/titanic-survival/titanic-survival.css') }}">
{% endblock %}

{% block content %}
<div class="titanic-project">
    <!-- Project Header -->
    <section class="project-hero">
        <div class="container">
            <div class="hero-content">
                <h1 class="project-title">{{ project.title }}</h1>
                <p class="project-subtitle">{{ project.description }}</p>
                
                <div class="project-meta">
                    <span class="category-badge">{{ project.category }}</span>
                    <span class="status-badge">{{ project.status or 'Completed' }}</span>
                </div>

                <div class="hero-actions">
                    {% if project.github_url %}
                    <a href="{{ project.github_url }}" class="btn btn-outline" target="_blank">
                        <i class="fas fa-code"></i> View Code
                    </a>
                    {% endif %}
                    <a href="#demo" class="btn btn-primary">
                        <i class="fas fa-play"></i> Try Demo
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Project Overview -->
    <section class="project-overview">
        <div class="container">
            <div class="overview-grid">
                <!-- Technology Stack -->
                <div class="overview-card">
                    <h3><i class="fas fa-tools"></i> Technology Stack</h3>
                    <div class="tech-stack">
                        {% for tech in project.technology_list %}
                        <span class="tech-badge">{{ tech }}</span>
                        {% endfor %}
                    </div>
                </div>

                <!-- Key Results -->
                <div class="overview-card">
                    <h3><i class="fas fa-chart-line"></i> Model Performance</h3>
                    <div class="results-grid">
                        {% for metric, value in project.results_dict.items() %}
                        <div class="metric">
                            <div class="metric-value">{{ value }}</div>
                            <div class="metric-label">{{ metric.replace('_', ' ').title() }}</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Interactive Demo Section -->
    <section id="demo" class="demo-section">
        <div class="container">
            <h2>Interactive Survival Prediction</h2>
            <p>Enter passenger details to predict their survival probability using our trained ensemble model.</p>
            
            <div class="demo-container">
                <div class="input-panel">
                    <h3>Passenger Information</h3>
                    <form id="prediction-form">
                        <div class="input-group">
                            <label for="pclass">Passenger Class:</label>
                            <select id="pclass" name="pclass">
                                <option value="1">First Class</option>
                                <option value="2">Second Class</option>
                                <option value="3" selected>Third Class</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="sex">Gender:</label>
                            <select id="sex" name="sex">
                                <option value="male" selected>Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="age">Age:</label>
                            <input type="number" id="age" name="age" value="29" min="0" max="100">
                        </div>

                        <div class="input-group">
                            <label for="sibsp">Siblings/Spouses aboard:</label>
                            <input type="number" id="sibsp" name="sibsp" value="0" min="0" max="10">
                        </div>

                        <div class="input-group">
                            <label for="parch">Parents/Children aboard:</label>
                            <input type="number" id="parch" name="parch" value="0" min="0" max="10">
                        </div>

                        <div class="input-group">
                            <label for="fare">Fare (Â£):</label>
                            <input type="number" id="fare" name="fare" value="32.0" step="0.01" min="0">
                        </div>

                        <div class="input-group">
                            <label for="embarked">Port of Embarkation:</label>
                            <select id="embarked" name="embarked">
                                <option value="S" selected>Southampton</option>
                                <option value="C">Cherbourg</option>
                                <option value="Q">Queenstown</option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary">Predict Survival</button>
                    </form>
                </div>

                <div class="results-panel">
                    <h3>Prediction Results</h3>
                    <div id="prediction-results" class="prediction-display">
                        <p>Enter passenger details and click "Predict Survival" to see results.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Challenges & Solutions -->
    <section class="challenges-section">
        <div class="container">
            <h2>Technical Challenges & Solutions</h2>
            <div class="challenges-grid">
                {% for challenge in project.challenges_list %}
                <div class="challenge-card">
                    <i class="fas fa-puzzle-piece"></i>
                    <p>{{ challenge }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Project Navigation -->
    <section class="project-nav">
        <div class="container">
            <a href="{{ url_for('projects') }}" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Back to Projects
            </a>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('prediction-form');
    const resultsDiv = document.getElementById('prediction-results');

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        
        // Simple prediction algorithm (replace with actual model)
        const prediction = calculateSurvival(data);
        
        // Display results
        displayResults(prediction, data);
    });

    function calculateSurvival(data) {
        let score = 0;
        
        // Gender (most important factor)
        if (data.sex === 'female') score += 0.4;
        
        // Class
        if (data.pclass === '1') score += 0.3;
        else if (data.pclass === '2') score += 0.15;
        
        // Age
        const age = parseInt(data.age);
        if (age < 16) score += 0.1;
        else if (age > 60) score -= 0.1;
        
        // Family size
        const familySize = parseInt(data.sibsp) + parseInt(data.parch);
        if (familySize > 0 && familySize < 4) score += 0.05;
        else if (familySize > 4) score -= 0.1;
        
        // Fare (wealth indicator)
        const fare = parseFloat(data.fare);
        if (fare > 50) score += 0.1;
        else if (fare < 10) score -= 0.05;
        
        return Math.max(0, Math.min(1, score));
    }

    function displayResults(probability, data) {
        const percentage = Math.round(probability * 100);
        const outcome = percentage > 50 ? 'Likely Survived' : 'Likely Perished';
        const className = percentage > 50 ? 'survived' : 'perished';
        
        resultsDiv.innerHTML = `
            <div class="prediction-result ${className}">
                <h4>Prediction: ${outcome}</h4>
                <div class="probability-bar">
                    <div class="probability-fill" style="width: ${percentage}%"></div>
                    <span class="probability-text">${percentage}% Survival Probability</span>
                </div>
                <div class="factors">
                    <h5>Key Factors:</h5>
                    <ul>
                        <li>Gender: ${data.sex === 'female' ? 'Positive' : 'Negative'} impact</li>
                        <li>Class: ${data.pclass === '1' ? 'Strong positive' : data.pclass === '2' ? 'Moderate positive' : 'Negative'} impact</li>
                        <li>Age: ${parseInt(data.age) < 16 ? 'Positive (child)' : parseInt(data.age) > 60 ? 'Negative (elderly)' : 'Neutral'} impact</li>
                    </ul>
                </div>
            </div>
        `;
    }
});
</script>
{% endblock %}