<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 3: Regularization - The Problem Solvers - ML Model Relationships</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tutorials/ml-model-relationships/ml-model-relationships.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tutorials/nlp/nlp.css') }}">
    <style>
        /* Chapter 3 Specific Styles */
        .regularization-demo {
            background: linear-gradient(135deg, #fef7ff 0%, #f3e8ff 100%);
            border: 2px solid #a855f7;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
        }
        
        .regularization-demo::before {
            content: "Regularization Demo";
            position: absolute;
            top: -12px;
            left: 20px;
            background: #a855f7;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .reg-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
            align-items: start;
        }
        
        .reg-type {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .reg-type:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .l1-reg {
            border-left: 4px solid #ef4444;
        }
        
        .l2-reg {
            border-left: 4px solid #3b82f6;
        }
        
        .reg-formula {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            font-family: 'Times New Roman', serif;
            font-size: 1.2rem;
            margin: 1rem 0;
            border: 2px solid #e2e8f0;
        }
        
        .feature-visualization {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 0.25rem;
            margin: 1rem 0;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .feature-bar {
            height: 60px;
            border-radius: 4px;
            display: flex;
            align-items: end;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .feature-bar:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }
        
        .path-visualization {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin: 2rem 0;
        }
        
        .lambda-slider {
            width: 100%;
            margin: 1rem 0;
            background: linear-gradient(to right, #fef3c7, #dc2626);
            border-radius: 4px;
            height: 8px;
        }
        
        .lambda-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1f2937;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        
        .coefficient-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .coefficient-card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .coefficient-card.zero {
            border-color: #ef4444;
            background: #fef2f2;
        }
        
        .coefficient-card.shrunk {
            border-color: #f59e0b;
            background: #fffbeb;
        }
        
        .coefficient-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .coefficient-label {
            font-size: 0.9rem;
            color: #64748b;
        }
        
        .use-case-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .use-case {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .use-case h4 {
            color: #1f2937;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .when-to-use {
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            border-left: 4px solid #0ea5e9;
        }
        
        .feature-selection {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b3 100%);
            border-left: 4px solid #ff9800;
        }
        
        .stability {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            border-left: 4px solid #9c27b0;
        }
        
        .limitation-box {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            border: 2px solid #f44336;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            position: relative;
        }
        
        .limitation-box::before {
            content: "Limitation Alert";
            position: absolute;
            top: -12px;
            left: 20px;
            background: #f44336;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .interactive-selector {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        
        .selector-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .selector-btn:hover, .selector-btn.active {
            border-color: #a855f7;
            background: #a855f7;
            color: white;
        }
        
        .scenario-result {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 2px solid #e2e8f0;
        }
        
        @media (max-width: 768px) {
            .reg-comparison {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .feature-visualization {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .coefficient-display {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .use-case-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="azbn-header">
        <nav class="azbn-nav" style="top: 50px;">
            <div class="azbn-container" style="display: flex; justify-content: space-between; align-items: center;">
                <a href="/tutorials/ml-model-relationships" style="text-decoration: none; color: #4f46e5; display: flex; align-items: center; gap: 0.5rem;">
                    <span>ML Model Relationships</span>
                </a>
                <div class="azbn-links">
                    <a href="/">Home</a>
                    <a href="/#about">About</a>
                    <a href="/tutorials/">Tutorials</a>
                    <a href="/#projects">Projects</a>
                    <a href="/contact">Contact</a>
                </div>
            </div>
        </nav>
    </header>

    <main style="padding-top: 100px;">
        <!-- Tutorial Header -->
        <div class="nlp-header">
            <h1>Chapter 3: Regularization - The Problem Solvers</h1>
            <p>Discover how L1 and L2 regularization solve overfitting problems and when to use each technique</p>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 37.5%;"></div>
            </div>
        </div>

        <!-- Course Navigation -->
        <div class="course-nav">
            <button class="nav-btn" onclick="window.location.href='/tutorials/ml-model-relationships/chapter1'">Chapter 1</button>
            <button class="nav-btn" onclick="window.location.href='/tutorials/ml-model-relationships/chapter2'">Chapter 2</button>
            <button class="nav-btn active" onclick="window.location.href='/tutorials/ml-model-relationships/chapter3'">Chapter 3</button>
            <button class="nav-btn" onclick="window.location.href='/tutorials/ml-model-relationships/chapter4'">Chapter 4</button>
            <button class="nav-btn" onclick="window.location.href='/tutorials/ml-model-relationships/chapter5'">Chapter 5</button>
            <button class="nav-btn" onclick="window.location.href='/tutorials/ml-model-relationships/chapter6'">Chapter 6</button>
            <button class="nav-btn" onclick="window.location.href='/tutorials/ml-model-relationships/chapter7'">Chapter 7</button>
            <button class="nav-btn" onclick="window.location.href='/tutorials/ml-model-relationships/chapter8'">Chapter 8</button>
        </div>

        <section class="azbn-section">
            <div class="azbn-container chapter1-container">

                <div class="progress-tracker">
                    <div class="progress-dot completed"></div>
                    <div class="progress-dot completed"></div>
                    <div class="progress-dot completed"></div>
                    <div class="progress-dot"></div>
                    <div class="progress-dot"></div>
                    <div class="progress-dot"></div>
                    <div class="progress-dot"></div>
                    <div class="progress-dot"></div>
                </div>

                <div class="section-nav">
                    <button class="active" onclick="showSection('overview')">Overview</button>
                    <button onclick="showSection('l1-l2')">L1 vs L2</button>
                    <button onclick="showSection('path')">Regularization Path</button>
                    <button onclick="showSection('applications')">When to Use</button>
                    <button onclick="showSection('quiz')">Quiz</button>
                </div>

                <!-- Overview Section -->
                <div id="overview" class="content-section active">
                    <h2>Regularization: The Overfitting Solution</h2>
                    <p>
                        Remember the problems from Chapter 2? Linear models were too simple, decision trees were too complex. 
                        Regularization provides a mathematical way to control model complexity.
                    </p>
                    
                    <div class="azbn-card">
                        <h3>The Core Idea</h3>
                        <p>Regularization adds a <strong>penalty term</strong> to the loss function that grows with model complexity:</p>
                        
                        <div class="reg-formula">
                            Loss = Prediction Error + λ × Complexity Penalty
                        </div>
                        
                        <p>Where <strong>λ (lambda)</strong> controls how much we penalize complexity:</p>
                        <ul>
                            <li>λ = 0: No penalty (original model)</li>
                            <li>λ small: Slight penalty (minor regularization)</li>
                            <li>λ large: Heavy penalty (strong regularization)</li>
                        </ul>
                    </div>

                    <div class="regularization-demo">
                        <h4>Interactive Regularization Concept</h4>
                        <p>Adjust the regularization strength to see its effect:</p>
                        
                        <div style="margin: 1.5rem 0;">
                            <label for="lambda-demo">Regularization Strength (λ):</label>
                            <input type="range" id="lambda-demo" class="lambda-slider" min="0" max="10" value="0" step="0.1" oninput="updateRegularizationDemo()">
                            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: #64748b; margin-top: 0.5rem;">
                                <span>No Regularization</span>
                                <span id="lambda-value">0.0</span>
                                <span>Strong Regularization</span>
                            </div>
                        </div>
                        
                        <div id="regularization-effect" style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                            <h5 id="effect-title">No Regularization Applied</h5>
                            <p id="effect-description">Model uses original complexity - may overfit to training data.</p>
                            <div style="display: flex; justify-content: space-around; margin: 1rem 0;">
                                <div style="text-align: center;">
                                    <div style="font-size: 1.2rem; font-weight: bold; color: #ef4444;" id="training-error">0.05</div>
                                    <div style="font-size: 0.9rem; color: #64748b;">Training Error</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 1.2rem; font-weight: bold; color: #3b82f6;" id="validation-error">0.15</div>
                                    <div style="font-size: 0.9rem; color: #64748b;">Validation Error</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3>Two Main Types</h3>
                    <p>There are two primary regularization techniques, each with different behaviors:</p>
                    
                    <div class="reg-comparison">
                        <div class="reg-type l1-reg">
                            <h4>L1 Regularization (Lasso)</h4>
                            <div class="reg-formula">
                                Penalty = λ × Σ|coefficients|
                            </div>
                            <p><strong>Effect:</strong> Drives some coefficients to exactly zero</p>
                            <p><strong>Result:</strong> Automatic feature selection</p>
                            <p><strong>Use when:</strong> You have many features and want to identify the most important ones</p>
                        </div>
                        
                        <div class="reg-type l2-reg">
                            <h4>L2 Regularization (Ridge)</h4>
                            <div class="reg-formula">
                                Penalty = λ × Σ(coefficients)²
                            </div>
                            <p><strong>Effect:</strong> Shrinks coefficients toward zero (but never exactly zero)</p>
                            <p><strong>Result:</strong> Smooth, stable predictions</p>
                            <p><strong>Use when:</strong> You want to keep all features but reduce their influence</p>
                        </div>
                    </div>
                </div>

                <!-- L1 vs L2 Section -->
                <div id="l1-l2" class="content-section">
                    <h2>L1 vs L2: The Detailed Comparison</h2>
                    <p>
                        The difference between L1 and L2 regularization isn't just mathematical - it has profound practical implications.
                    </p>

                    <div style="text-align: center; margin: 2rem 0;">
                        <img src="/static/images/tutorials/ml-model-relationships/chapter3/l1-vs-l2-comparison.png" 
                             alt="Side-by-side comparison of L1 and L2 regularization effects on feature selection"
                             style="width: 100%; max-width: 800px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.15);">
                    </div>

                    <div class="regularization-demo">
                        <h4>Interactive L1 vs L2 Demonstration</h4>
                        <p>See how different regularization types affect feature coefficients:</p>
                        
                        <div class="interactive-selector">
                            <button class="selector-btn active" onclick="selectRegularization('l1')">L1 Regularization</button>
                            <button class="selector-btn" onclick="selectRegularization('l2')">L2 Regularization</button>
                            <button class="selector-btn" onclick="selectRegularization('none')">No Regularization</button>
                        </div>
                        
                        <div style="margin: 1.5rem 0;">
                            <label for="reg-strength">Regularization Strength:</label>
                            <input type="range" id="reg-strength" min="0" max="10" value="3" step="0.5" oninput="updateFeatureCoefficients()">
                            <span id="reg-strength-value">3.0</span>
                        </div>
                        
                        <div class="coefficient-display">
                            <div class="coefficient-card" id="coef-1">
                                <div class="coefficient-value">0.8</div>
                                <div class="coefficient-label">Feature 1</div>
                            </div>
                            <div class="coefficient-card" id="coef-2">
                                <div class="coefficient-value">0.6</div>
                                <div class="coefficient-label">Feature 2</div>
                            </div>
                            <div class="coefficient-card" id="coef-3">
                                <div class="coefficient-value">0.4</div>
                                <div class="coefficient-label">Feature 3</div>
                            </div>
                            <div class="coefficient-card" id="coef-4">
                                <div class="coefficient-value">0.2</div>
                                <div class="coefficient-label">Feature 4</div>
                            </div>
                            <div class="coefficient-card" id="coef-5">
                                <div class="coefficient-value">0.1</div>
                                <div class="coefficient-label">Feature 5</div>
                            </div>
                        </div>
                        
                        <div id="regularization-explanation" style="background: white; padding: 1rem; border-radius: 8px;">
                            <h5 id="reg-explanation-title">L1 Regularization Active</h5>
                            <p id="reg-explanation-text">L1 is driving smaller coefficients toward zero, effectively removing less important features.</p>
                        </div>
                    </div>

                    <div class="azbn-card">
                        <h3>Key Differences Explained</h3>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 1rem 0;">
                            <div>
                                <h4 style="color: #ef4444;">L1 Regularization (Lasso)</h4>
                                <ul>
                                    <li><strong>Sparsity:</strong> Creates sparse models (many zeros)</li>
                                    <li><strong>Feature Selection:</strong> Automatically selects features</li>
                                    <li><strong>Interpretability:</strong> Easier to understand (fewer features)</li>
                                    <li><strong>Instability:</strong> Can be unstable with correlated features</li>
                                    <li><strong>Use Case:</strong> High-dimensional data with irrelevant features</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 style="color: #3b82f6;">L2 Regularization (Ridge)</h4>
                                <ul>
                                    <li><strong>Shrinkage:</strong> Shrinks all coefficients uniformly</li>
                                    <li><strong>Stability:</strong> More stable with correlated features</li>
                                    <li><strong>Smoothness:</strong> Produces smooth, stable predictions</li>
                                    <li><strong>No Selection:</strong> Keeps all features (with reduced weights)</li>
                                    <li><strong>Use Case:</strong> When all features might be relevant</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Regularization Path Section -->
                <div id="path" class="content-section">
                    <h2>The Regularization Path</h2>
                    <p>
                        Understanding how coefficients change as we increase regularization strength is crucial 
                        for choosing the right λ value.
                    </p>

                    <div style="text-align: center; margin: 2rem 0;">
                        <img src="/static/images/tutorials/ml-model-relationships/chapter3/regularization-path.png" 
                             alt="Regularization path plot showing how coefficients change with regularization strength"
                             style="width: 100%; max-width: 800px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.15);">
                    </div>

                    <div class="path-visualization">
                        <h4>Interactive Regularization Path</h4>
                        <p>Move the slider to see how coefficients evolve with regularization strength:</p>
                        
                        <div style="margin: 1.5rem 0;">
                            <label for="path-lambda">λ (Regularization Strength):</label>
                            <input type="range" id="path-lambda" min="0" max="10" value="0" step="0.1" oninput="updateRegularizationPath()">
                            <div style="display: flex; justify-content: space-between; margin-top: 0.5rem;">
                                <span style="font-size: 0.9rem; color: #64748b;">λ = 0.0</span>
                                <span style="font-size: 0.9rem; color: #64748b;" id="path-lambda-value">λ = 0.0</span>
                                <span style="font-size: 0.9rem; color: #64748b;">λ = 10.0</span>
                            </div>
                        </div>
                        
                        <div class="feature-visualization" id="path-features">
                            <!-- Features will be generated by JavaScript -->
                        </div>
                        
                        <div id="path-explanation" style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                            <h5>No Regularization (λ = 0.0)</h5>
                            <p>All features retain their original importance. Risk of overfitting is highest.</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin: 1.5rem 0;">
                            <div style="text-align: center; padding: 1rem; background: #fef2f2; border-radius: 8px;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #ef4444;" id="features-zero">0</div>
                                <div style="font-size: 0.9rem; color: #64748b;">Features = 0</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: #fffbeb; border-radius: 8px;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #f59e0b;" id="features-small">10</div>
                                <div style="font-size: 0.9rem; color: #64748b;">Active Features</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: #f0fdf4; border-radius: 8px;">
                                <div style="font-size: 1.2rem; font-weight: bold; color: #22c55e;" id="model-complexity">100%</div>
                                <div style="font-size: 0.9rem; color: #64748b;">Model Complexity</div>
                            </div>
                        </div>
                    </div>

                    <div class="azbn-card">
                        <h3>Choosing the Right λ</h3>
                        <p>The optimal λ balances underfitting and overfitting:</p>
                        
                        <ul>
                            <li><strong>Too Small (λ ≈ 0):</strong> No regularization, potential overfitting</li>
                            <li><strong>Just Right:</strong> Good balance, best validation performance</li>
                            <li><strong>Too Large:</strong> Over-regularization, underfitting</li>
                        </ul>
                        
                        <p><strong>Cross-validation</strong> is typically used to find the optimal λ by testing different values 
                        and choosing the one that gives the best validation performance.</p>
                    </div>
                </div>

                <!-- Applications Section -->
                <div id="applications" class="content-section">
                    <h2>When to Use Each Regularization</h2>
                    <p>
                        Choosing between L1, L2, or no regularization depends on your specific situation 
                        and data characteristics.
                    </p>

                    <div class="use-case-grid">
                        <div class="use-case when-to-use">
                            <h4>Use L1 (Lasso) When:</h4>
                            <ul>
                                <li>You have <strong>many features</strong> (high-dimensional data)</li>
                                <li>You suspect <strong>only some features</strong> are truly important</li>
                                <li>You want <strong>automatic feature selection</strong></li>
                                <li>Model <strong>interpretability</strong> is crucial</li>
                                <li>You're doing <strong>exploratory analysis</strong></li>
                            </ul>
                            <p><strong>Example:</strong> Gene expression data with 20,000 features but only a few are disease-related.</p>
                        </div>
                        
                        <div class="use-case feature-selection">
                            <h4>Use L2 (Ridge) When:</h4>
                            <ul>
                                <li>You believe <strong>most features</strong> contribute to the outcome</li>
                                <li>Features are <strong>highly correlated</strong></li>
                                <li>You want <strong>stable, smooth</strong> predictions</li>
                                <li>You have <strong>multicollinearity</strong> issues</li>
                                <li><strong>Prediction accuracy</strong> is more important than interpretability</li>
                            </ul>
                            <p><strong>Example:</strong> House price prediction where size, location, age, etc. all matter.</p>
                        </div>
                        
                        <div class="use-case stability">
                            <h4>Use Elastic Net When:</h4>
                            <ul>
                                <li>You want <strong>both L1 and L2</strong> benefits</li>
                                <li>You have <strong>groups of correlated features</strong></li>
                                <li>You want some <strong>feature selection + stability</strong></li>
                                <li>You're <strong>unsure</strong> which regularization is better</li>
                            </ul>
                            <p><strong>Formula:</strong> α × L1 + (1-α) × L2</p>
                        </div>
                    </div>

                    <div class="regularization-demo">
                        <h4>Regularization Decision Helper</h4>
                        <p>Answer these questions to get a recommendation:</p>
                        
                        <div style="margin: 1.5rem 0;">
                            <div style="margin: 1rem 0;">
                                <label><strong>How many features do you have?</strong></label>
                                <div class="interactive-selector">
                                    <button class="selector-btn" onclick="updateDecision('features', 'few')">Few (&lt;20)</button>
                                    <button class="selector-btn" onclick="updateDecision('features', 'moderate')">Moderate (20-100)</button>
                                    <button class="selector-btn" onclick="updateDecision('features', 'many')">Many (&gt;100)</button>
                                </div>
                            </div>
                            
                            <div style="margin: 1rem 0;">
                                <label><strong>How important is interpretability?</strong></label>
                                <div class="interactive-selector">
                                    <button class="selector-btn" onclick="updateDecision('interpretability', 'low')">Not Important</button>
                                    <button class="selector-btn" onclick="updateDecision('interpretability', 'moderate')">Somewhat Important</button>
                                    <button class="selector-btn" onclick="updateDecision('interpretability', 'high')">Very Important</button>
                                </div>
                            </div>
                            
                            <div style="margin: 1rem 0;">
                                <label><strong>Are your features correlated?</strong></label>
                                <div class="interactive-selector">
                                    <button class="selector-btn" onclick="updateDecision('correlation', 'low')">Independent</button>
                                    <button class="selector-btn" onclick="updateDecision('correlation', 'moderate')">Some Correlation</button>
                                    <button class="selector-btn" onclick="updateDecision('correlation', 'high')">Highly Correlated</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="scenario-result">
                            <h5 id="decision-title">Make your selections above</h5>
                            <p id="decision-recommendation">Choose the characteristics of your data to get a personalized regularization recommendation.</p>
                        </div>
                    </div>

                    <div class="limitation-box">
                        <h4>Regularization Limitations</h4>
                        <p>While regularization solves many problems, it has its own limitations:</p>
                        <ul>
                            <li><strong>Still Single Models:</strong> Even regularized models are still just one perspective</li>
                            <li><strong>Hyperparameter Tuning:</strong> Finding the right λ requires cross-validation</li>
                            <li><strong>Linear Relationships:</strong> Doesn't help linear models capture non-linear patterns</li>
                            <li><strong>Feature Engineering:</strong> Still requires good feature engineering</li>
                        </ul>
                        <p><strong>This is why we need ensemble methods!</strong> They combine multiple models to overcome these remaining limitations.</p>
                    </div>
                </div>

                <!-- Quiz Section -->
                <div id="quiz" class="content-section">
                    <h2>Chapter 3 Quiz</h2>
                    <p>Test your understanding of regularization techniques:</p>

                    <div class="quiz-section">
                        <div class="quiz-question">
                            <h4>Question 1: What is the main difference between L1 and L2 regularization?</h4>
                            <button class="quiz-option" onclick="selectAnswer(1, 'a', false)">L1 is faster to compute than L2</button>
                            <button class="quiz-option" onclick="selectAnswer(1, 'b', true)">L1 can set coefficients to exactly zero, L2 only shrinks them</button>
                            <button class="quiz-option" onclick="selectAnswer(1, 'c', false)">L2 is more accurate than L1</button>
                            <button class="quiz-option" onclick="selectAnswer(1, 'd', false)">There is no practical difference</button>
                            <div id="q1-explanation" style="display: none; margin-top: 1rem; padding: 1rem; background: #e8f5e8; border-radius: 8px;">
                                <strong>Correct!</strong> L1 regularization can drive coefficients to exactly zero (automatic feature selection), while L2 only shrinks coefficients toward zero but never reaches exactly zero.
                            </div>
                        </div>

                        <div class="quiz-question">
                            <h4>Question 2: When would you choose L1 regularization over L2?</h4>
                            <button class="quiz-option" onclick="selectAnswer(2, 'a', false)">When you have very few features</button>
                            <button class="quiz-option" onclick="selectAnswer(2, 'b', true)">When you have many features and want automatic feature selection</button>
                            <button class="quiz-option" onclick="selectAnswer(2, 'c', false)">When features are highly correlated</button>
                            <button class="quiz-option" onclick="selectAnswer(2, 'd', false)">When you want the most stable predictions</button>
                            <div id="q2-explanation" style="display: none; margin-top: 1rem; padding: 1rem; background: #e8f5e8; border-radius: 8px;">
                                <strong>Exactly!</strong> L1 is ideal when you have high-dimensional data with many potentially irrelevant features, as it automatically performs feature selection by setting unimportant coefficients to zero.
                            </div>
                        </div>

                        <div class="quiz-question">
                            <h4>Question 3: What problem do regularization techniques NOT solve?</h4>
                            <button class="quiz-option" onclick="selectAnswer(3, 'a', false)">Overfitting</button>
                            <button class="quiz-option" onclick="selectAnswer(3, 'b', false)">High variance in predictions</button>
                            <button class="quiz-option" onclick="selectAnswer(3, 'c', true)">The limitation of having only one model perspective</button>
                            <button class="quiz-option" onclick="selectAnswer(3, 'd', false)">Feature selection (for L1)</button>
                            <div id="q3-explanation" style="display: none; margin-top: 1rem; padding: 1rem; background: #e8f5e8; border-radius: 8px;">
                                <strong>Perfect!</strong> Regularization helps with overfitting and variance but doesn't solve the fundamental limitation that you still have only one model. This is why ensemble methods (combining multiple models) are the next logical step!
                            </div>
                        </div>

                        <div style="text-align: center; margin: 2rem 0;">
                            <button onclick="submitQuiz()" class="azbn-btn">Submit Quiz</button>
                            <div id="quiz-results" style="margin-top: 1rem; font-size: 1.2rem; font-weight: bold;"></div>
                        </div>
                    </div>
                </div>


            </div>
        </section>
    </main>

    <script>
        let quizAnswers = {};
        let currentRegularization = 'l1';
        let decisionFactors = {};
        
        // Section Navigation
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName).classList.add('active');
            
            document.querySelectorAll('.section-nav button').forEach(button => {
                button.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Regularization Demo Functions
        function updateRegularizationDemo() {
            const lambda = parseFloat(document.getElementById('lambda-demo').value);
            document.getElementById('lambda-value').textContent = lambda.toFixed(1);
            
            const title = document.getElementById('effect-title');
            const description = document.getElementById('effect-description');
            const trainingError = document.getElementById('training-error');
            const validationError = document.getElementById('validation-error');
            
            // Simulate regularization effects
            const baseTraining = 0.05;
            const baseValidation = 0.15;
            
            const newTraining = baseTraining + (lambda * 0.02);
            const newValidation = Math.max(0.08, baseValidation - (lambda * 0.01));
            
            trainingError.textContent = newTraining.toFixed(2);
            validationError.textContent = newValidation.toFixed(2);
            
            if (lambda < 1) {
                title.textContent = "Minimal Regularization";
                description.textContent = "Little constraint on model complexity - still risk of overfitting.";
            } else if (lambda < 5) {
                title.textContent = "Moderate Regularization";
                description.textContent = "Good balance - reducing overfitting while maintaining model capacity.";
            } else {
                title.textContent = "Strong Regularization";
                description.textContent = "Heavy constraint - may start underfitting as model becomes too simple.";
            }
        }

        // L1 vs L2 Comparison
        function selectRegularization(type) {
            document.querySelectorAll('.selector-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            currentRegularization = type;
            updateFeatureCoefficients();
        }

        function updateFeatureCoefficients() {
            const strength = parseFloat(document.getElementById('reg-strength').value);
            document.getElementById('reg-strength-value').textContent = strength.toFixed(1);
            
            const baseCoefficients = [0.8, 0.6, 0.4, 0.2, 0.1];
            const title = document.getElementById('reg-explanation-title');
            const text = document.getElementById('reg-explanation-text');
            
            for (let i = 1; i <= 5; i++) {
                const card = document.getElementById(`coef-${i}`);
                const valueElement = card.querySelector('.coefficient-value');
                let newValue = baseCoefficients[i-1];
                
                card.classList.remove('zero', 'shrunk');
                
                if (currentRegularization === 'l1') {
                    // L1: Set smaller coefficients to zero
                    if (strength > 2 && newValue < 0.3) newValue = 0;
                    else if (strength > 5 && newValue < 0.5) newValue = 0;
                    else if (strength > 8 && newValue < 0.7) newValue = 0;
                    else newValue = Math.max(0, newValue - (strength * 0.05));
                    
                    if (newValue === 0) card.classList.add('zero');
                    else if (newValue < baseCoefficients[i-1] * 0.7) card.classList.add('shrunk');
                    
                    title.textContent = "L1 Regularization Active";
                    text.textContent = "L1 is driving smaller coefficients toward zero, effectively removing less important features.";
                } else if (currentRegularization === 'l2') {
                    // L2: Shrink all coefficients proportionally
                    newValue = newValue * Math.exp(-strength * 0.1);
                    
                    if (newValue < baseCoefficients[i-1] * 0.7) card.classList.add('shrunk');
                    
                    title.textContent = "L2 Regularization Active";
                    text.textContent = "L2 is shrinking all coefficients proportionally, maintaining all features but reducing their influence.";
                } else {
                    title.textContent = "No Regularization";
                    text.textContent = "All features maintain their original coefficients - risk of overfitting if data is complex.";
                }
                
                valueElement.textContent = newValue.toFixed(2);
            }
        }

        // Regularization Path Visualization
        function updateRegularizationPath() {
            const lambda = parseFloat(document.getElementById('path-lambda').value);
            document.getElementById('path-lambda-value').textContent = `λ = ${lambda.toFixed(1)}`;
            
            const container = document.getElementById('path-features');
            const explanation = document.getElementById('path-explanation');
            
            // Generate feature bars
            const features = 10;
            const baseHeights = [80, 70, 60, 50, 40, 30, 25, 20, 15, 10];
            let html = '';
            let featuresZero = 0;
            let activeFeatures = features;
            
            for (let i = 0; i < features; i++) {
                let height = baseHeights[i];
                let color = '#3b82f6';
                
                // Apply regularization effect
                if (lambda > 2 && height < 30) {
                    height = 0;
                    color = '#ef4444';
                    featuresZero++;
                    activeFeatures--;
                } else if (lambda > 5 && height < 50) {
                    height = 0;
                    color = '#ef4444';
                    featuresZero++;
                    activeFeatures--;
                } else {
                    height = Math.max(10, height * (1 - lambda * 0.1));
                    if (height < baseHeights[i] * 0.6) color = '#f59e0b';
                }
                
                html += `<div class="feature-bar" style="height: ${height}px; background: ${color};">${i+1}</div>`;
            }
            
            container.innerHTML = html;
            
            // Update metrics
            document.getElementById('features-zero').textContent = featuresZero;
            document.getElementById('features-small').textContent = activeFeatures;
            document.getElementById('model-complexity').textContent = `${Math.max(10, 100 - lambda * 10)}%`;
            
            // Update explanation
            if (lambda < 1) {
                explanation.innerHTML = '<h5>Low Regularization (λ < 1.0)</h5><p>Most features retain their importance. Some regularization effect but risk of overfitting remains.</p>';
            } else if (lambda < 5) {
                explanation.innerHTML = '<h5>Moderate Regularization (λ = 1-5)</h5><p>Smaller features being eliminated, important features shrinking. Good balance point.</p>';
            } else {
                explanation.innerHTML = '<h5>Strong Regularization (λ > 5)</h5><p>Many features eliminated, even important features heavily shrunk. Risk of underfitting.</p>';
            }
        }

        // Decision Helper
        function updateDecision(factor, value) {
            // Remove active class from siblings
            const parent = event.target.parentElement;
            parent.querySelectorAll('.selector-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            decisionFactors[factor] = value;
            
            // Generate recommendation
            const title = document.getElementById('decision-title');
            const recommendation = document.getElementById('decision-recommendation');
            
            if (Object.keys(decisionFactors).length < 3) {
                title.textContent = "Keep selecting...";
                recommendation.textContent = "Answer all questions to get your personalized recommendation.";
                return;
            }
            
            let regType = '';
            let explanation = '';
            
            if (decisionFactors.features === 'many' && decisionFactors.interpretability === 'high') {
                regType = 'L1 Regularization (Lasso)';
                explanation = 'High-dimensional data + need for interpretability = L1 for automatic feature selection.';
            } else if (decisionFactors.correlation === 'high') {
                regType = 'L2 Regularization (Ridge)';
                explanation = 'Highly correlated features work better with L2, which handles multicollinearity better.';
            } else if (decisionFactors.features === 'few' && decisionFactors.interpretability === 'low') {
                regType = 'L2 Regularization (Ridge)';
                explanation = 'With few features and no interpretability constraints, L2 provides stable, smooth predictions.';
            } else if (decisionFactors.features === 'many' && decisionFactors.interpretability === 'low') {
                regType = 'Elastic Net';
                explanation = 'Combines L1 and L2 benefits - some feature selection with stability for high-dimensional data.';
            } else {
                regType = 'L1 Regularization (Lasso)';
                explanation = 'When in doubt with many features, L1 helps identify the most important ones.';
            }
            
            title.textContent = `Recommended: ${regType}`;
            recommendation.textContent = explanation;
        }

        // Quiz Functions
        function selectAnswer(questionNum, option, isCorrect) {
            const question = event.target.closest('.quiz-question');
            question.querySelectorAll('.quiz-option').forEach(btn => {
                btn.classList.remove('selected', 'correct', 'incorrect');
            });
            
            event.target.classList.add('selected');
            quizAnswers[questionNum] = { option, isCorrect };
        }

        function submitQuiz() {
            const totalQuestions = 3;
            let correctAnswers = 0;
            
            for (let i = 1; i <= totalQuestions; i++) {
                const question = document.querySelector(`.quiz-question:nth-child(${i})`);
                const selectedBtn = question.querySelector('.quiz-option.selected');
                
                if (quizAnswers[i]) {
                    if (quizAnswers[i].isCorrect) {
                        selectedBtn.classList.add('correct');
                        correctAnswers++;
                        document.getElementById(`q${i}-explanation`).style.display = 'block';
                    } else {
                        selectedBtn.classList.add('incorrect');
                        const correctBtn = question.querySelector('.quiz-option[onclick*="true"]');
                        if (correctBtn) correctBtn.classList.add('correct');
                    }
                }
            }
            
            const score = Math.round((correctAnswers / totalQuestions) * 100);
            const results = document.getElementById('quiz-results');
            
            let message = `Score: ${correctAnswers}/${totalQuestions} (${score}%)`;
            if (score >= 80) {
                message += '<br>Excellent! You understand regularization well and are ready for ensemble methods!';
            } else if (score >= 60) {
                message += '<br>Good progress! Review the L1 vs L2 differences before moving on.';
            } else {
                message += '<br>Study more! Focus on understanding when to use L1 vs L2 regularization.';
            }
            
            results.innerHTML = message;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateRegularizationDemo();
            updateFeatureCoefficients();
            updateRegularizationPath();
        });
    </script>
</body>
</html>